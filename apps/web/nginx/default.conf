log_format opscopilot_json escape=json '{'
  '"timestamp":"$time_iso8601",'
  '"level":"INFO",'
  '"service":"web",'
  '"component":"nginx_access",'
  '"message":"http access",'
  '"remote_addr":"$remote_addr",'
  '"method":"$request_method",'
  '"path":"$request_uri",'
  '"protocol":"$server_protocol",'
  '"status":$status,'
  '"bytes_sent":$body_bytes_sent,'
  '"referer":"$http_referer",'
  '"user_agent":"$http_user_agent",'
  '"request_id":"$request_id"'
'}';

server {
  listen 80;
  server_name _;

  access_log /dev/stdout opscopilot_json;
  error_log /dev/stderr info;

  root /usr/share/nginx/html;
  index index.html;

  location /api/ {
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Connection "";
    proxy_buffering off;
    proxy_pass http://api:8000;
  }

  location / {
    try_files $uri /index.html;
  }
}
